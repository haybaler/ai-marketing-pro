(()=>{var a={};a.id=412,a.ids=[412],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:a=>{"use strict";a.exports=require("punycode")},27910:a=>{"use strict";a.exports=require("stream")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:a=>{"use strict";a.exports=require("tls")},39727:()=>{},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:a=>{"use strict";a.exports=require("crypto")},55591:a=>{"use strict";a.exports=require("https")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},71982:(a,b,c)=>{"use strict";let d,e,f;c.r(b),c.d(b,{handler:()=>cf,patchFetch:()=>ce,routeModule:()=>ca,serverHooks:()=>cd,workAsyncStorage:()=>cb,workUnitAsyncStorage:()=>cc});var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ab,ac,ad,ae,af={};c.r(af),c.d(af,{POST:()=>b6});var ag=c(96559),ah=c(48088),ai=c(37719),aj=c(26191),ak=c(81289),al=c(261),am=c(92603),an=c(39893),ao=c(14823),ap=c(47220),aq=c(66946),ar=c(47912),as=c(99786),at=c(46143),au=c(86439),av=c(43365),aw=c(40694);function ax(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c}function ay(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)}let az=function(){let{crypto:a}=globalThis;if(a?.randomUUID)return az=a.randomUUID.bind(a),a.randomUUID();let b=new Uint8Array(1),c=a?()=>a.getRandomValues(b)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,a=>(a^c()&15>>a/4).toString(16))};function aA(a){return"object"==typeof a&&null!==a&&("name"in a&&"AbortError"===a.name||"message"in a&&String(a.message).includes("FetchRequestCanceledException"))}let aB=a=>{if(a instanceof Error)return a;if("object"==typeof a&&null!==a){try{if("[object Error]"===Object.prototype.toString.call(a)){let b=Error(a.message,a.cause?{cause:a.cause}:{});return a.stack&&(b.stack=a.stack),a.cause&&!b.cause&&(b.cause=a.cause),a.name&&(b.name=a.name),b}}catch{}try{return Error(JSON.stringify(a))}catch{}}return Error(a)};class aC extends Error{}class aD extends aC{constructor(a,b,c,d){super(`${aD.makeMessage(a,b,c)}`),this.status=a,this.headers=d,this.requestID=d?.get("request-id"),this.error=b}static makeMessage(a,b,c){let d=b?.message?"string"==typeof b.message?b.message:JSON.stringify(b.message):b?JSON.stringify(b):c;return a&&d?`${a} ${d}`:a?`${a} status code (no body)`:d||"(no status code or body)"}static generate(a,b,c,d){return a&&d?400===a?new aH(a,b,c,d):401===a?new aI(a,b,c,d):403===a?new aJ(a,b,c,d):404===a?new aK(a,b,c,d):409===a?new aL(a,b,c,d):422===a?new aM(a,b,c,d):429===a?new aN(a,b,c,d):a>=500?new aO(a,b,c,d):new aD(a,b,c,d):new aF({message:c,cause:aB(b)})}}class aE extends aD{constructor({message:a}={}){super(void 0,void 0,a||"Request was aborted.",void 0)}}class aF extends aD{constructor({message:a,cause:b}){super(void 0,void 0,a||"Connection error.",void 0),b&&(this.cause=b)}}class aG extends aF{constructor({message:a}={}){super({message:a??"Request timed out."})}}class aH extends aD{}class aI extends aD{}class aJ extends aD{}class aK extends aD{}class aL extends aD{}class aM extends aD{}class aN extends aD{}class aO extends aD{}let aP=/^[a-z][a-z0-9+.-]*:/i,aQ=a=>(aQ=Array.isArray)(a),aR=aQ;function aS(a){return"object"!=typeof a?{}:a??{}}let aT=a=>{try{return JSON.parse(a)}catch(a){return}},aU="0.56.0",aV=a=>"x32"===a?"x32":"x86_64"===a||"x64"===a?"x64":"arm"===a?"arm":"aarch64"===a||"arm64"===a?"arm64":a?`other:${a}`:"unknown",aW=a=>(a=a.toLowerCase()).includes("ios")?"iOS":"android"===a?"Android":"darwin"===a?"MacOS":"win32"===a?"Windows":"freebsd"===a?"FreeBSD":"openbsd"===a?"OpenBSD":"linux"===a?"Linux":a?`Other:${a}`:"Unknown";function aX(...a){let b=globalThis.ReadableStream;if(void 0===b)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new b(...a)}function aY(a){let b=Symbol.asyncIterator in a?a[Symbol.asyncIterator]():a[Symbol.iterator]();return aX({start(){},async pull(a){let{done:c,value:d}=await b.next();c?a.close():a.enqueue(d)},async cancel(){await b.return?.()}})}function aZ(a){if(a[Symbol.asyncIterator])return a;let b=a.getReader();return{async next(){try{let a=await b.read();return a?.done&&b.releaseLock(),a}catch(a){throw b.releaseLock(),a}},async return(){let a=b.cancel();return b.releaseLock(),await a,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function a$(a){if(null===a||"object"!=typeof a)return;if(a[Symbol.asyncIterator])return void await a[Symbol.asyncIterator]().return?.();let b=a.getReader(),c=b.cancel();b.releaseLock(),await c}let a_=({headers:a,body:b})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(b)});function a0(a){let b;return(e??(e=(b=new globalThis.TextEncoder).encode.bind(b)))(a)}function a1(a){let b;return(f??(f=(b=new globalThis.TextDecoder).decode.bind(b)))(a)}class a2{constructor(){g.set(this,void 0),h.set(this,void 0),ax(this,g,new Uint8Array,"f"),ax(this,h,null,"f")}decode(a){let b;if(null==a)return[];let c=a instanceof ArrayBuffer?new Uint8Array(a):"string"==typeof a?a0(a):a;ax(this,g,function(a){let b=0;for(let c of a)b+=c.length;let c=new Uint8Array(b),d=0;for(let b of a)c.set(b,d),d+=b.length;return c}([ay(this,g,"f"),c]),"f");let d=[];for(;null!=(b=function(a,b){for(let c=b??0;c<a.length;c++){if(10===a[c])return{preceding:c,index:c+1,carriage:!1};if(13===a[c])return{preceding:c,index:c+1,carriage:!0}}return null}(ay(this,g,"f"),ay(this,h,"f")));){if(b.carriage&&null==ay(this,h,"f")){ax(this,h,b.index,"f");continue}if(null!=ay(this,h,"f")&&(b.index!==ay(this,h,"f")+1||b.carriage)){d.push(a1(ay(this,g,"f").subarray(0,ay(this,h,"f")-1))),ax(this,g,ay(this,g,"f").subarray(ay(this,h,"f")),"f"),ax(this,h,null,"f");continue}let a=null!==ay(this,h,"f")?b.preceding-1:b.preceding,c=a1(ay(this,g,"f").subarray(0,a));d.push(c),ax(this,g,ay(this,g,"f").subarray(b.index),"f"),ax(this,h,null,"f")}return d}flush(){return ay(this,g,"f").length?this.decode("\n"):[]}}g=new WeakMap,h=new WeakMap,a2.NEWLINE_CHARS=new Set(["\n","\r"]),a2.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let a3={off:0,error:200,warn:300,info:400,debug:500},a4=(a,b,c)=>{if(a){if(Object.prototype.hasOwnProperty.call(a3,a))return a;a9(c).warn(`${b} was set to ${JSON.stringify(a)}, expected one of ${JSON.stringify(Object.keys(a3))}`)}};function a5(){}function a6(a,b,c){return!b||a3[a]>a3[c]?a5:b[a].bind(b)}let a7={error:a5,warn:a5,info:a5,debug:a5},a8=new WeakMap;function a9(a){let b=a.logger,c=a.logLevel??"off";if(!b)return a7;let d=a8.get(b);if(d&&d[0]===c)return d[1];let e={error:a6("error",b,c),warn:a6("warn",b,c),info:a6("info",b,c),debug:a6("debug",b,c)};return a8.set(b,[c,e]),e}let ba=a=>(a.options&&(a.options={...a.options},delete a.options.headers),a.headers&&(a.headers=Object.fromEntries((a.headers instanceof Headers?[...a.headers]:Object.entries(a.headers)).map(([a,b])=>[a,"x-api-key"===a.toLowerCase()||"authorization"===a.toLowerCase()||"cookie"===a.toLowerCase()||"set-cookie"===a.toLowerCase()?"***":b]))),"retryOfRequestLogID"in a&&(a.retryOfRequestLogID&&(a.retryOf=a.retryOfRequestLogID),delete a.retryOfRequestLogID),a);class bb{constructor(a,b,c){this.iterator=a,i.set(this,void 0),this.controller=b,ax(this,i,c,"f")}static fromSSEResponse(a,b,c){let d=!1,e=c?a9(c):console;async function*f(){if(d)throw new aC("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");d=!0;let c=!1;try{for await(let c of bc(a,b)){if("completion"===c.event)try{yield JSON.parse(c.data)}catch(a){throw e.error("Could not parse message into JSON:",c.data),e.error("From chunk:",c.raw),a}if("message_start"===c.event||"message_delta"===c.event||"message_stop"===c.event||"content_block_start"===c.event||"content_block_delta"===c.event||"content_block_stop"===c.event)try{yield JSON.parse(c.data)}catch(a){throw e.error("Could not parse message into JSON:",c.data),e.error("From chunk:",c.raw),a}if("ping"!==c.event&&"error"===c.event)throw new aD(void 0,aT(c.data)??c.data,void 0,a.headers)}c=!0}catch(a){if(aA(a))return;throw a}finally{c||b.abort()}}return new bb(f,b,c)}static fromReadableStream(a,b,c){let d=!1;async function*e(){let b=new a2;for await(let c of aZ(a))for(let a of b.decode(c))yield a;for(let a of b.flush())yield a}return new bb(async function*(){if(d)throw new aC("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");d=!0;let a=!1;try{for await(let b of e())!a&&b&&(yield JSON.parse(b));a=!0}catch(a){if(aA(a))return;throw a}finally{a||b.abort()}},b,c)}[(i=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let a=[],b=[],c=this.iterator(),d=d=>({next:()=>{if(0===d.length){let d=c.next();a.push(d),b.push(d)}return d.shift()}});return[new bb(()=>d(a),this.controller,ay(this,i,"f")),new bb(()=>d(b),this.controller,ay(this,i,"f"))]}toReadableStream(){let a,b=this;return aX({async start(){a=b[Symbol.asyncIterator]()},async pull(b){try{let{value:c,done:d}=await a.next();if(d)return b.close();let e=a0(JSON.stringify(c)+"\n");b.enqueue(e)}catch(a){b.error(a)}},async cancel(){await a.return?.()}})}}async function*bc(a,b){if(!a.body){if(b.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new aC("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new aC("Attempted to iterate over a response with no body")}let c=new be,d=new a2;for await(let b of bd(aZ(a.body)))for(let a of d.decode(b)){let b=c.decode(a);b&&(yield b)}for(let a of d.flush()){let b=c.decode(a);b&&(yield b)}}async function*bd(a){let b=new Uint8Array;for await(let c of a){let a;if(null==c)continue;let d=c instanceof ArrayBuffer?new Uint8Array(c):"string"==typeof c?a0(c):c,e=new Uint8Array(b.length+d.length);for(e.set(b),e.set(d,b.length),b=e;-1!==(a=function(a){for(let b=0;b<a.length-1;b++){if(10===a[b]&&10===a[b+1]||13===a[b]&&13===a[b+1])return b+2;if(13===a[b]&&10===a[b+1]&&b+3<a.length&&13===a[b+2]&&10===a[b+3])return b+4}return -1}(b));)yield b.slice(0,a),b=b.slice(a)}b.length>0&&(yield b)}class be{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(a){if(a.endsWith("\r")&&(a=a.substring(0,a.length-1)),!a){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(a),a.startsWith(":"))return null;let[b,c,d]=function(a,b){let c=a.indexOf(":");return -1!==c?[a.substring(0,c),b,a.substring(c+b.length)]:[a,"",""]}(a,":");return d.startsWith(" ")&&(d=d.substring(1)),"event"===b?this.event=d:"data"===b&&this.data.push(d),null}}async function bf(a,b){let{response:c,requestLogID:d,retryOfRequestLogID:e,startTime:f}=b,g=await (async()=>{if(b.options.stream)return(a9(a).debug("response",c.status,c.url,c.headers,c.body),b.options.__streamClass)?b.options.__streamClass.fromSSEResponse(c,b.controller,a):bb.fromSSEResponse(c,b.controller,a);if(204===c.status)return null;if(b.options.__binaryResponse)return c;let d=c.headers.get("content-type"),e=d?.split(";")[0]?.trim();return e?.includes("application/json")||e?.endsWith("+json")?bg(await c.json(),c):await c.text()})();return a9(a).debug(`[${d}] response parsed`,ba({retryOfRequestLogID:e,url:c.url,status:c.status,body:g,durationMs:Date.now()-f})),g}function bg(a,b){return!a||"object"!=typeof a||Array.isArray(a)?a:Object.defineProperty(a,"_request_id",{value:b.headers.get("request-id"),enumerable:!1})}class bh extends Promise{constructor(a,b,c=bf){super(a=>{a(null)}),this.responsePromise=b,this.parseResponse=c,j.set(this,void 0),ax(this,j,a,"f")}_thenUnwrap(a){return new bh(ay(this,j,"f"),this.responsePromise,async(b,c)=>bg(a(await this.parseResponse(b,c),c),c.response))}asResponse(){return this.responsePromise.then(a=>a.response)}async withResponse(){let[a,b]=await Promise.all([this.parse(),this.asResponse()]);return{data:a,response:b,request_id:b.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(a=>this.parseResponse(ay(this,j,"f"),a))),this.parsedPromise}then(a,b){return this.parse().then(a,b)}catch(a){return this.parse().catch(a)}finally(a){return this.parse().finally(a)}}j=new WeakMap;class bi{constructor(a,b,c,d){k.set(this,void 0),ax(this,k,a,"f"),this.options=d,this.response=b,this.body=c}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let a=this.nextPageRequestOptions();if(!a)throw new aC("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await ay(this,k,"f").requestAPIList(this.constructor,a)}async *iterPages(){let a=this;for(yield a;a.hasNextPage();)a=await a.getNextPage(),yield a}async *[(k=new WeakMap,Symbol.asyncIterator)](){for await(let a of this.iterPages())for(let b of a.getPaginatedItems())yield b}}class bj extends bh{constructor(a,b,c){super(a,b,async(a,b)=>new c(a,b.response,await bf(a,b),b.options))}async *[Symbol.asyncIterator](){for await(let a of(await this))yield a}}class bk extends bi{constructor(a,b,c,d){super(a,b,c,d),this.data=c.data||[],this.has_more=c.has_more||!1,this.first_id=c.first_id||null,this.last_id=c.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){if(this.options.query?.before_id){let a=this.first_id;return a?{...this.options,query:{...aS(this.options.query),before_id:a}}:null}let a=this.last_id;return a?{...this.options,query:{...aS(this.options.query),after_id:a}}:null}}let bl=()=>{if("undefined"==typeof File){let{process:a}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof a?.versions?.node&&20>parseInt(a.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function bm(a,b,c){return bl(),new File(a,b??"unknown_file",c)}function bn(a){return("object"==typeof a&&null!==a&&("name"in a&&a.name&&String(a.name)||"url"in a&&a.url&&String(a.url)||"filename"in a&&a.filename&&String(a.filename)||"path"in a&&a.path&&String(a.path))||"").split(/[\\/]/).pop()||void 0}let bo=a=>null!=a&&"object"==typeof a&&"function"==typeof a[Symbol.asyncIterator],bp=async(a,b)=>({...a,body:await br(a.body,b)}),bq=new WeakMap,br=async(a,b)=>{if(!await function(a){let b="function"==typeof a?a:a.fetch,c=bq.get(b);if(c)return c;let d=(async()=>{try{let a="Response"in b?b.Response:(await b("data:,")).constructor,c=new FormData;if(c.toString()===await new a(c).text())return!1;return!0}catch{return!0}})();return bq.set(b,d),d}(b))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let c=new FormData;return await Promise.all(Object.entries(a||{}).map(([a,b])=>bu(c,a,b))),c},bs=a=>a instanceof Blob&&"name"in a,bt=a=>{if((a=>"object"==typeof a&&null!==a&&(a instanceof Response||bo(a)||bs(a)))(a))return!0;if(Array.isArray(a))return a.some(bt);if(a&&"object"==typeof a){for(let b in a)if(bt(a[b]))return!0}return!1},bu=async(a,b,c)=>{if(void 0!==c){if(null==c)throw TypeError(`Received null for "${b}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof c||"number"==typeof c||"boolean"==typeof c)a.append(b,String(c));else if(c instanceof Response){let d={},e=c.headers.get("Content-Type");e&&(d={type:e}),a.append(b,bm([await c.blob()],bn(c),d))}else if(bo(c))a.append(b,bm([await new Response(aY(c)).blob()],bn(c)));else if(bs(c))a.append(b,bm([c],bn(c),{type:c.type}));else if(Array.isArray(c))await Promise.all(c.map(c=>bu(a,b+"[]",c)));else if("object"==typeof c)await Promise.all(Object.entries(c).map(([c,d])=>bu(a,`${b}[${c}]`,d)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${c} instead`)}},bv=a=>null!=a&&"object"==typeof a&&"number"==typeof a.size&&"string"==typeof a.type&&"function"==typeof a.text&&"function"==typeof a.slice&&"function"==typeof a.arrayBuffer;async function bw(a,b,c){let d,e;if(bl(),a=await a,b||(b=bn(a)),null!=(d=a)&&"object"==typeof d&&"string"==typeof d.name&&"number"==typeof d.lastModified&&bv(d))return a instanceof File&&null==b&&null==c?a:bm([await a.arrayBuffer()],b??a.name,{type:a.type,lastModified:a.lastModified,...c});if(null!=(e=a)&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob){let d=await a.blob();return b||(b=new URL(a.url).pathname.split(/[\\/]/).pop()),bm(await bx(d),b,c)}let f=await bx(a);if(!c?.type){let a=f.find(a=>"object"==typeof a&&"type"in a&&a.type);"string"==typeof a&&(c={...c,type:a})}return bm(f,b,c)}async function bx(a){let b=[];if("string"==typeof a||ArrayBuffer.isView(a)||a instanceof ArrayBuffer)b.push(a);else if(bv(a))b.push(a instanceof Blob?a:await a.arrayBuffer());else if(bo(a))for await(let c of a)b.push(...await bx(c));else{let b=a?.constructor?.name;throw Error(`Unexpected data type: ${typeof a}${b?`; constructor: ${b}`:""}${function(a){if("object"!=typeof a||null===a)return"";let b=Object.getOwnPropertyNames(a);return`; props: [${b.map(a=>`"${a}"`).join(", ")}]`}(a)}`)}return b}class by{constructor(a){this._client=a}}let bz=Symbol.for("brand.privateNullableHeaders"),bA=a=>{let b=new Headers,c=new Set;for(let d of a){let a=new Set;for(let[e,f]of function*(a){let b;if(!a)return;if(bz in a){let{values:b,nulls:c}=a;for(let a of(yield*b.entries(),c))yield[a,null];return}let c=!1;for(let d of(a instanceof Headers?b=a.entries():aR(a)?b=a:(c=!0,b=Object.entries(a??{})),b)){let a=d[0];if("string"!=typeof a)throw TypeError("expected header name to be a string");let b=aR(d[1])?d[1]:[d[1]],e=!1;for(let d of b)void 0!==d&&(c&&!e&&(e=!0,yield[a,null]),yield[a,d])}}(d)){let d=e.toLowerCase();a.has(d)||(b.delete(e),a.add(d)),null===f?(b.delete(e),c.add(d)):(b.append(e,f),c.delete(d))}}return{[bz]:!0,values:b,nulls:c}};function bB(a){return a.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let bC=Object.freeze(Object.create(null)),bD=((a=bB)=>function(b,...c){let d;if(1===b.length)return b[0];let e=!1,f=[],g=b.reduce((b,d,g)=>{/[?#]/.test(d)&&(e=!0);let h=c[g],i=(e?encodeURIComponent:a)(""+h);return g!==c.length&&(null==h||"object"==typeof h&&h.toString===Object.getPrototypeOf(Object.getPrototypeOf(h.hasOwnProperty??bC)??bC)?.toString)&&(i=h+"",f.push({start:b.length+d.length,length:i.length,error:`Value of type ${Object.prototype.toString.call(h).slice(8,-1)} is not a valid path parameter`})),b+d+(g===c.length?"":i)},""),h=g.split(/[?#]/,1)[0],i=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(d=i.exec(h));)f.push({start:d.index,length:d[0].length,error:`Value "${d[0]}" can't be safely passed as a path parameter`});if(f.sort((a,b)=>a.start-b.start),f.length>0){let a=0,b=f.reduce((b,c)=>{let d=" ".repeat(c.start-a),e="^".repeat(c.length);return a=c.start+c.length,b+d+e},"");throw new aC(`Path parameters result in path with invalid segments:
${f.map(a=>a.error).join("\n")}
${g}
${b}`)}return g})(bB);class bE extends by{list(a={},b){let{betas:c,...d}=a??{};return this._client.getAPIList("/v1/files",bk,{query:d,...b,headers:bA([{"anthropic-beta":[...c??[],"files-api-2025-04-14"].toString()},b?.headers])})}delete(a,b={},c){let{betas:d}=b??{};return this._client.delete(bD`/v1/files/${a}`,{...c,headers:bA([{"anthropic-beta":[...d??[],"files-api-2025-04-14"].toString()},c?.headers])})}download(a,b={},c){let{betas:d}=b??{};return this._client.get(bD`/v1/files/${a}/content`,{...c,headers:bA([{"anthropic-beta":[...d??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},c?.headers]),__binaryResponse:!0})}retrieveMetadata(a,b={},c){let{betas:d}=b??{};return this._client.get(bD`/v1/files/${a}`,{...c,headers:bA([{"anthropic-beta":[...d??[],"files-api-2025-04-14"].toString()},c?.headers])})}upload(a,b){let{betas:c,...d}=a;return this._client.post("/v1/files",bp({body:d,...b,headers:bA([{"anthropic-beta":[...c??[],"files-api-2025-04-14"].toString()},b?.headers])},this._client))}}class bF extends by{retrieve(a,b={},c){let{betas:d}=b??{};return this._client.get(bD`/v1/models/${a}?beta=true`,{...c,headers:bA([{...d?.toString()!=null?{"anthropic-beta":d?.toString()}:void 0},c?.headers])})}list(a={},b){let{betas:c,...d}=a??{};return this._client.getAPIList("/v1/models?beta=true",bk,{query:d,...b,headers:bA([{...c?.toString()!=null?{"anthropic-beta":c?.toString()}:void 0},b?.headers])})}}class bG{constructor(a,b){this.iterator=a,this.controller=b}async *decoder(){let a=new a2;for await(let b of this.iterator)for(let c of a.decode(b))yield JSON.parse(c);for(let b of a.flush())yield JSON.parse(b)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(a,b){if(!a.body){if(b.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new aC("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new aC("Attempted to iterate over a response with no body")}return new bG(aZ(a.body),b)}}class bH extends by{create(a,b){let{betas:c,...d}=a;return this._client.post("/v1/messages/batches?beta=true",{body:d,...b,headers:bA([{"anthropic-beta":[...c??[],"message-batches-2024-09-24"].toString()},b?.headers])})}retrieve(a,b={},c){let{betas:d}=b??{};return this._client.get(bD`/v1/messages/batches/${a}?beta=true`,{...c,headers:bA([{"anthropic-beta":[...d??[],"message-batches-2024-09-24"].toString()},c?.headers])})}list(a={},b){let{betas:c,...d}=a??{};return this._client.getAPIList("/v1/messages/batches?beta=true",bk,{query:d,...b,headers:bA([{"anthropic-beta":[...c??[],"message-batches-2024-09-24"].toString()},b?.headers])})}delete(a,b={},c){let{betas:d}=b??{};return this._client.delete(bD`/v1/messages/batches/${a}?beta=true`,{...c,headers:bA([{"anthropic-beta":[...d??[],"message-batches-2024-09-24"].toString()},c?.headers])})}cancel(a,b={},c){let{betas:d}=b??{};return this._client.post(bD`/v1/messages/batches/${a}/cancel?beta=true`,{...c,headers:bA([{"anthropic-beta":[...d??[],"message-batches-2024-09-24"].toString()},c?.headers])})}async results(a,b={},c){let d=await this.retrieve(a);if(!d.results_url)throw new aC(`No batch \`results_url\`; Has it finished processing? ${d.processing_status} - ${d.id}`);let{betas:e}=b??{};return this._client.get(d.results_url,{...c,headers:bA([{"anthropic-beta":[...e??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},c?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((a,b)=>bG.fromResponse(b.response,b.controller))}}let bI=a=>{if(0===a.length)return a;let b=a[a.length-1];switch(b.type){case"separator":return bI(a=a.slice(0,a.length-1));case"number":let c=b.value[b.value.length-1];if("."===c||"-"===c)return bI(a=a.slice(0,a.length-1));case"string":let d=a[a.length-2];if(d?.type==="delimiter"||d?.type==="brace"&&"{"===d.value)return bI(a=a.slice(0,a.length-1));break;case"delimiter":return bI(a=a.slice(0,a.length-1))}return a},bJ=a=>JSON.parse((a=>{let b="";return a.map(a=>{"string"===a.type?b+='"'+a.value+'"':b+=a.value}),b})((a=>{let b=[];return a.map(a=>{"brace"===a.type&&("{"===a.value?b.push("}"):b.splice(b.lastIndexOf("}"),1)),"paren"===a.type&&("["===a.value?b.push("]"):b.splice(b.lastIndexOf("]"),1))}),b.length>0&&b.reverse().map(b=>{"}"===b?a.push({type:"brace",value:"}"}):"]"===b&&a.push({type:"paren",value:"]"})}),a})(bI((a=>{let b=0,c=[];for(;b<a.length;){let d=a[b];if("\\"===d){b++;continue}if("{"===d){c.push({type:"brace",value:"{"}),b++;continue}if("}"===d){c.push({type:"brace",value:"}"}),b++;continue}if("["===d){c.push({type:"paren",value:"["}),b++;continue}if("]"===d){c.push({type:"paren",value:"]"}),b++;continue}if(":"===d){c.push({type:"separator",value:":"}),b++;continue}if(","===d){c.push({type:"delimiter",value:","}),b++;continue}if('"'===d){let e="",f=!1;for(d=a[++b];'"'!==d;){if(b===a.length){f=!0;break}if("\\"===d){if(++b===a.length){f=!0;break}e+=d+a[b],d=a[++b]}else e+=d,d=a[++b]}d=a[++b],f||c.push({type:"string",value:e});continue}let e=/\s/;if(d&&e.test(d)){b++;continue}let f=/[0-9]/;if(d&&f.test(d)||"-"===d||"."===d){let e="";for("-"===d&&(e+=d,d=a[++b]);d&&f.test(d)||"."===d;)e+=d,d=a[++b];c.push({type:"number",value:e});continue}let g=/[a-z]/i;if(d&&g.test(d)){let e="";for(;d&&g.test(d)&&b!==a.length;)e+=d,d=a[++b];"true"==e||"false"==e||"null"===e?c.push({type:"name",value:e}):b++;continue}b++}return c})(a))))),bK="__json_buf";function bL(a){return"tool_use"===a.type||"server_tool_use"===a.type||"mcp_tool_use"===a.type}class bM{constructor(){l.add(this),this.messages=[],this.receivedMessages=[],m.set(this,void 0),this.controller=new AbortController,n.set(this,void 0),o.set(this,()=>{}),p.set(this,()=>{}),q.set(this,void 0),r.set(this,()=>{}),s.set(this,()=>{}),t.set(this,{}),u.set(this,!1),v.set(this,!1),w.set(this,!1),x.set(this,!1),y.set(this,void 0),z.set(this,void 0),C.set(this,a=>{if(ax(this,v,!0,"f"),aA(a)&&(a=new aE),a instanceof aE)return ax(this,w,!0,"f"),this._emit("abort",a);if(a instanceof aC)return this._emit("error",a);if(a instanceof Error){let b=new aC(a.message);return b.cause=a,this._emit("error",b)}return this._emit("error",new aC(String(a)))}),ax(this,n,new Promise((a,b)=>{ax(this,o,a,"f"),ax(this,p,b,"f")}),"f"),ax(this,q,new Promise((a,b)=>{ax(this,r,a,"f"),ax(this,s,b,"f")}),"f"),ay(this,n,"f").catch(()=>{}),ay(this,q,"f").catch(()=>{})}get response(){return ay(this,y,"f")}get request_id(){return ay(this,z,"f")}async withResponse(){let a=await ay(this,n,"f");if(!a)throw Error("Could not resolve a `Response` object");return{data:this,response:a,request_id:a.headers.get("request-id")}}static fromReadableStream(a){let b=new bM;return b._run(()=>b._fromReadableStream(a)),b}static createMessage(a,b,c){let d=new bM;for(let a of b.messages)d._addMessageParam(a);return d._run(()=>d._createMessage(a,{...b,stream:!0},{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}_run(a){a().then(()=>{this._emitFinal(),this._emit("end")},ay(this,C,"f"))}_addMessageParam(a){this.messages.push(a)}_addMessage(a,b=!0){this.receivedMessages.push(a),b&&this._emit("message",a)}async _createMessage(a,b,c){let d,e=c?.signal;e&&(e.aborted&&this.controller.abort(),d=this.controller.abort.bind(this.controller),e.addEventListener("abort",d));try{ay(this,l,"m",D).call(this);let{response:d,data:e}=await a.create({...b,stream:!0},{...c,signal:this.controller.signal}).withResponse();for await(let a of(this._connected(d),e))ay(this,l,"m",E).call(this,a);if(e.controller.signal?.aborted)throw new aE;ay(this,l,"m",F).call(this)}finally{e&&d&&e.removeEventListener("abort",d)}}_connected(a){this.ended||(ax(this,y,a,"f"),ax(this,z,a?.headers.get("request-id"),"f"),ay(this,o,"f").call(this,a),this._emit("connect"))}get ended(){return ay(this,u,"f")}get errored(){return ay(this,v,"f")}get aborted(){return ay(this,w,"f")}abort(){this.controller.abort()}on(a,b){return(ay(this,t,"f")[a]||(ay(this,t,"f")[a]=[])).push({listener:b}),this}off(a,b){let c=ay(this,t,"f")[a];if(!c)return this;let d=c.findIndex(a=>a.listener===b);return d>=0&&c.splice(d,1),this}once(a,b){return(ay(this,t,"f")[a]||(ay(this,t,"f")[a]=[])).push({listener:b,once:!0}),this}emitted(a){return new Promise((b,c)=>{ax(this,x,!0,"f"),"error"!==a&&this.once("error",c),this.once(a,b)})}async done(){ax(this,x,!0,"f"),await ay(this,q,"f")}get currentMessage(){return ay(this,m,"f")}async finalMessage(){return await this.done(),ay(this,l,"m",A).call(this)}async finalText(){return await this.done(),ay(this,l,"m",B).call(this)}_emit(a,...b){if(ay(this,u,"f"))return;"end"===a&&(ax(this,u,!0,"f"),ay(this,r,"f").call(this));let c=ay(this,t,"f")[a];if(c&&(ay(this,t,"f")[a]=c.filter(a=>!a.once),c.forEach(({listener:a})=>a(...b))),"abort"===a){let a=b[0];ay(this,x,"f")||c?.length||Promise.reject(a),ay(this,p,"f").call(this,a),ay(this,s,"f").call(this,a),this._emit("end");return}if("error"===a){let a=b[0];ay(this,x,"f")||c?.length||Promise.reject(a),ay(this,p,"f").call(this,a),ay(this,s,"f").call(this,a),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",ay(this,l,"m",A).call(this))}async _fromReadableStream(a,b){let c,d=b?.signal;d&&(d.aborted&&this.controller.abort(),c=this.controller.abort.bind(this.controller),d.addEventListener("abort",c));try{ay(this,l,"m",D).call(this),this._connected(null);let b=bb.fromReadableStream(a,this.controller);for await(let a of b)ay(this,l,"m",E).call(this,a);if(b.controller.signal?.aborted)throw new aE;ay(this,l,"m",F).call(this)}finally{d&&c&&d.removeEventListener("abort",c)}}[(m=new WeakMap,n=new WeakMap,o=new WeakMap,p=new WeakMap,q=new WeakMap,r=new WeakMap,s=new WeakMap,t=new WeakMap,u=new WeakMap,v=new WeakMap,w=new WeakMap,x=new WeakMap,y=new WeakMap,z=new WeakMap,C=new WeakMap,l=new WeakSet,A=function(){if(0===this.receivedMessages.length)throw new aC("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},B=function(){if(0===this.receivedMessages.length)throw new aC("stream ended without producing a Message with role=assistant");let a=this.receivedMessages.at(-1).content.filter(a=>"text"===a.type).map(a=>a.text);if(0===a.length)throw new aC("stream ended without producing a content block with type=text");return a.join(" ")},D=function(){this.ended||ax(this,m,void 0,"f")},E=function(a){if(this.ended)return;let b=ay(this,l,"m",G).call(this,a);switch(this._emit("streamEvent",a,b),a.type){case"content_block_delta":{let c=b.content.at(-1);switch(a.delta.type){case"text_delta":"text"===c.type&&this._emit("text",a.delta.text,c.text||"");break;case"citations_delta":"text"===c.type&&this._emit("citation",a.delta.citation,c.citations??[]);break;case"input_json_delta":bL(c)&&c.input&&this._emit("inputJson",a.delta.partial_json,c.input);break;case"thinking_delta":"thinking"===c.type&&this._emit("thinking",a.delta.thinking,c.thinking);break;case"signature_delta":"thinking"===c.type&&this._emit("signature",c.signature);break;default:a.delta}break}case"message_stop":this._addMessageParam(b),this._addMessage(b,!0);break;case"content_block_stop":this._emit("contentBlock",b.content.at(-1));break;case"message_start":ax(this,m,b,"f")}},F=function(){if(this.ended)throw new aC("stream has ended, this shouldn't happen");let a=ay(this,m,"f");if(!a)throw new aC("request ended without sending any chunks");return ax(this,m,void 0,"f"),a},G=function(a){let b=ay(this,m,"f");if("message_start"===a.type){if(b)throw new aC(`Unexpected event order, got ${a.type} before receiving "message_stop"`);return a.message}if(!b)throw new aC(`Unexpected event order, got ${a.type} before "message_start"`);switch(a.type){case"message_stop":return b;case"message_delta":return b.container=a.delta.container,b.stop_reason=a.delta.stop_reason,b.stop_sequence=a.delta.stop_sequence,b.usage.output_tokens=a.usage.output_tokens,null!=a.usage.input_tokens&&(b.usage.input_tokens=a.usage.input_tokens),null!=a.usage.cache_creation_input_tokens&&(b.usage.cache_creation_input_tokens=a.usage.cache_creation_input_tokens),null!=a.usage.cache_read_input_tokens&&(b.usage.cache_read_input_tokens=a.usage.cache_read_input_tokens),null!=a.usage.server_tool_use&&(b.usage.server_tool_use=a.usage.server_tool_use),b;case"content_block_start":return b.content.push(a.content_block),b;case"content_block_delta":{let c=b.content.at(a.index);switch(a.delta.type){case"text_delta":c?.type==="text"&&(b.content[a.index]={...c,text:(c.text||"")+a.delta.text});break;case"citations_delta":c?.type==="text"&&(b.content[a.index]={...c,citations:[...c.citations??[],a.delta.citation]});break;case"input_json_delta":if(c&&bL(c)){let d=c[bK]||"";d+=a.delta.partial_json;let e={...c};if(Object.defineProperty(e,bK,{value:d,enumerable:!1,writable:!0}),d)try{e.input=bJ(d)}catch(b){let a=new aC(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${b}. JSON: ${d}`);ay(this,C,"f").call(this,a)}b.content[a.index]=e}break;case"thinking_delta":c?.type==="thinking"&&(b.content[a.index]={...c,thinking:c.thinking+a.delta.thinking});break;case"signature_delta":c?.type==="thinking"&&(b.content[a.index]={...c,signature:a.delta.signature});break;default:a.delta}return b}case"content_block_stop":return b}},Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("streamEvent",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new bb(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}let bN={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192},bO={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};class bP extends by{constructor(){super(...arguments),this.batches=new bH(this._client)}create(a,b){let{betas:c,...d}=a;d.model in bO&&console.warn(`The model '${d.model}' is deprecated and will reach end-of-life on ${bO[d.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let e=this._client._options.timeout;if(!d.stream&&null==e){let a=bN[d.model]??void 0;e=this._client.calculateNonstreamingTimeout(d.max_tokens,a)}return this._client.post("/v1/messages?beta=true",{body:d,timeout:e??6e5,...b,headers:bA([{...c?.toString()!=null?{"anthropic-beta":c?.toString()}:void 0},b?.headers]),stream:a.stream??!1})}stream(a,b){return bM.createMessage(this,a,b)}countTokens(a,b){let{betas:c,...d}=a;return this._client.post("/v1/messages/count_tokens?beta=true",{body:d,...b,headers:bA([{"anthropic-beta":[...c??[],"token-counting-2024-11-01"].toString()},b?.headers])})}}bP.Batches=bH;class bQ extends by{constructor(){super(...arguments),this.models=new bF(this._client),this.messages=new bP(this._client),this.files=new bE(this._client)}}bQ.Models=bF,bQ.Messages=bP,bQ.Files=bE;class bR extends by{create(a,b){let{betas:c,...d}=a;return this._client.post("/v1/complete",{body:d,timeout:this._client._options.timeout??6e5,...b,headers:bA([{...c?.toString()!=null?{"anthropic-beta":c?.toString()}:void 0},b?.headers]),stream:a.stream??!1})}}let bS="__json_buf";function bT(a){return"tool_use"===a.type||"server_tool_use"===a.type}class bU{constructor(){H.add(this),this.messages=[],this.receivedMessages=[],I.set(this,void 0),this.controller=new AbortController,J.set(this,void 0),K.set(this,()=>{}),L.set(this,()=>{}),M.set(this,void 0),N.set(this,()=>{}),O.set(this,()=>{}),P.set(this,{}),Q.set(this,!1),R.set(this,!1),S.set(this,!1),T.set(this,!1),U.set(this,void 0),V.set(this,void 0),Y.set(this,a=>{if(ax(this,R,!0,"f"),aA(a)&&(a=new aE),a instanceof aE)return ax(this,S,!0,"f"),this._emit("abort",a);if(a instanceof aC)return this._emit("error",a);if(a instanceof Error){let b=new aC(a.message);return b.cause=a,this._emit("error",b)}return this._emit("error",new aC(String(a)))}),ax(this,J,new Promise((a,b)=>{ax(this,K,a,"f"),ax(this,L,b,"f")}),"f"),ax(this,M,new Promise((a,b)=>{ax(this,N,a,"f"),ax(this,O,b,"f")}),"f"),ay(this,J,"f").catch(()=>{}),ay(this,M,"f").catch(()=>{})}get response(){return ay(this,U,"f")}get request_id(){return ay(this,V,"f")}async withResponse(){let a=await ay(this,J,"f");if(!a)throw Error("Could not resolve a `Response` object");return{data:this,response:a,request_id:a.headers.get("request-id")}}static fromReadableStream(a){let b=new bU;return b._run(()=>b._fromReadableStream(a)),b}static createMessage(a,b,c){let d=new bU;for(let a of b.messages)d._addMessageParam(a);return d._run(()=>d._createMessage(a,{...b,stream:!0},{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}_run(a){a().then(()=>{this._emitFinal(),this._emit("end")},ay(this,Y,"f"))}_addMessageParam(a){this.messages.push(a)}_addMessage(a,b=!0){this.receivedMessages.push(a),b&&this._emit("message",a)}async _createMessage(a,b,c){let d,e=c?.signal;e&&(e.aborted&&this.controller.abort(),d=this.controller.abort.bind(this.controller),e.addEventListener("abort",d));try{ay(this,H,"m",Z).call(this);let{response:d,data:e}=await a.create({...b,stream:!0},{...c,signal:this.controller.signal}).withResponse();for await(let a of(this._connected(d),e))ay(this,H,"m",$).call(this,a);if(e.controller.signal?.aborted)throw new aE;ay(this,H,"m",_).call(this)}finally{e&&d&&e.removeEventListener("abort",d)}}_connected(a){this.ended||(ax(this,U,a,"f"),ax(this,V,a?.headers.get("request-id"),"f"),ay(this,K,"f").call(this,a),this._emit("connect"))}get ended(){return ay(this,Q,"f")}get errored(){return ay(this,R,"f")}get aborted(){return ay(this,S,"f")}abort(){this.controller.abort()}on(a,b){return(ay(this,P,"f")[a]||(ay(this,P,"f")[a]=[])).push({listener:b}),this}off(a,b){let c=ay(this,P,"f")[a];if(!c)return this;let d=c.findIndex(a=>a.listener===b);return d>=0&&c.splice(d,1),this}once(a,b){return(ay(this,P,"f")[a]||(ay(this,P,"f")[a]=[])).push({listener:b,once:!0}),this}emitted(a){return new Promise((b,c)=>{ax(this,T,!0,"f"),"error"!==a&&this.once("error",c),this.once(a,b)})}async done(){ax(this,T,!0,"f"),await ay(this,M,"f")}get currentMessage(){return ay(this,I,"f")}async finalMessage(){return await this.done(),ay(this,H,"m",W).call(this)}async finalText(){return await this.done(),ay(this,H,"m",X).call(this)}_emit(a,...b){if(ay(this,Q,"f"))return;"end"===a&&(ax(this,Q,!0,"f"),ay(this,N,"f").call(this));let c=ay(this,P,"f")[a];if(c&&(ay(this,P,"f")[a]=c.filter(a=>!a.once),c.forEach(({listener:a})=>a(...b))),"abort"===a){let a=b[0];ay(this,T,"f")||c?.length||Promise.reject(a),ay(this,L,"f").call(this,a),ay(this,O,"f").call(this,a),this._emit("end");return}if("error"===a){let a=b[0];ay(this,T,"f")||c?.length||Promise.reject(a),ay(this,L,"f").call(this,a),ay(this,O,"f").call(this,a),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",ay(this,H,"m",W).call(this))}async _fromReadableStream(a,b){let c,d=b?.signal;d&&(d.aborted&&this.controller.abort(),c=this.controller.abort.bind(this.controller),d.addEventListener("abort",c));try{ay(this,H,"m",Z).call(this),this._connected(null);let b=bb.fromReadableStream(a,this.controller);for await(let a of b)ay(this,H,"m",$).call(this,a);if(b.controller.signal?.aborted)throw new aE;ay(this,H,"m",_).call(this)}finally{d&&c&&d.removeEventListener("abort",c)}}[(I=new WeakMap,J=new WeakMap,K=new WeakMap,L=new WeakMap,M=new WeakMap,N=new WeakMap,O=new WeakMap,P=new WeakMap,Q=new WeakMap,R=new WeakMap,S=new WeakMap,T=new WeakMap,U=new WeakMap,V=new WeakMap,Y=new WeakMap,H=new WeakSet,W=function(){if(0===this.receivedMessages.length)throw new aC("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},X=function(){if(0===this.receivedMessages.length)throw new aC("stream ended without producing a Message with role=assistant");let a=this.receivedMessages.at(-1).content.filter(a=>"text"===a.type).map(a=>a.text);if(0===a.length)throw new aC("stream ended without producing a content block with type=text");return a.join(" ")},Z=function(){this.ended||ax(this,I,void 0,"f")},$=function(a){if(this.ended)return;let b=ay(this,H,"m",aa).call(this,a);switch(this._emit("streamEvent",a,b),a.type){case"content_block_delta":{let c=b.content.at(-1);switch(a.delta.type){case"text_delta":"text"===c.type&&this._emit("text",a.delta.text,c.text||"");break;case"citations_delta":"text"===c.type&&this._emit("citation",a.delta.citation,c.citations??[]);break;case"input_json_delta":bT(c)&&c.input&&this._emit("inputJson",a.delta.partial_json,c.input);break;case"thinking_delta":"thinking"===c.type&&this._emit("thinking",a.delta.thinking,c.thinking);break;case"signature_delta":"thinking"===c.type&&this._emit("signature",c.signature);break;default:a.delta}break}case"message_stop":this._addMessageParam(b),this._addMessage(b,!0);break;case"content_block_stop":this._emit("contentBlock",b.content.at(-1));break;case"message_start":ax(this,I,b,"f")}},_=function(){if(this.ended)throw new aC("stream has ended, this shouldn't happen");let a=ay(this,I,"f");if(!a)throw new aC("request ended without sending any chunks");return ax(this,I,void 0,"f"),a},aa=function(a){let b=ay(this,I,"f");if("message_start"===a.type){if(b)throw new aC(`Unexpected event order, got ${a.type} before receiving "message_stop"`);return a.message}if(!b)throw new aC(`Unexpected event order, got ${a.type} before "message_start"`);switch(a.type){case"message_stop":return b;case"message_delta":return b.stop_reason=a.delta.stop_reason,b.stop_sequence=a.delta.stop_sequence,b.usage.output_tokens=a.usage.output_tokens,null!=a.usage.input_tokens&&(b.usage.input_tokens=a.usage.input_tokens),null!=a.usage.cache_creation_input_tokens&&(b.usage.cache_creation_input_tokens=a.usage.cache_creation_input_tokens),null!=a.usage.cache_read_input_tokens&&(b.usage.cache_read_input_tokens=a.usage.cache_read_input_tokens),null!=a.usage.server_tool_use&&(b.usage.server_tool_use=a.usage.server_tool_use),b;case"content_block_start":return b.content.push({...a.content_block}),b;case"content_block_delta":{let c=b.content.at(a.index);switch(a.delta.type){case"text_delta":c?.type==="text"&&(b.content[a.index]={...c,text:(c.text||"")+a.delta.text});break;case"citations_delta":c?.type==="text"&&(b.content[a.index]={...c,citations:[...c.citations??[],a.delta.citation]});break;case"input_json_delta":if(c&&bT(c)){let d=c[bS]||"";d+=a.delta.partial_json;let e={...c};Object.defineProperty(e,bS,{value:d,enumerable:!1,writable:!0}),d&&(e.input=bJ(d)),b.content[a.index]=e}break;case"thinking_delta":c?.type==="thinking"&&(b.content[a.index]={...c,thinking:c.thinking+a.delta.thinking});break;case"signature_delta":c?.type==="thinking"&&(b.content[a.index]={...c,signature:a.delta.signature});break;default:a.delta}return b}case"content_block_stop":return b}},Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("streamEvent",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new bb(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class bV extends by{create(a,b){return this._client.post("/v1/messages/batches",{body:a,...b})}retrieve(a,b){return this._client.get(bD`/v1/messages/batches/${a}`,b)}list(a={},b){return this._client.getAPIList("/v1/messages/batches",bk,{query:a,...b})}delete(a,b){return this._client.delete(bD`/v1/messages/batches/${a}`,b)}cancel(a,b){return this._client.post(bD`/v1/messages/batches/${a}/cancel`,b)}async results(a,b){let c=await this.retrieve(a);if(!c.results_url)throw new aC(`No batch \`results_url\`; Has it finished processing? ${c.processing_status} - ${c.id}`);return this._client.get(c.results_url,{...b,headers:bA([{Accept:"application/binary"},b?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((a,b)=>bG.fromResponse(b.response,b.controller))}}class bW extends by{constructor(){super(...arguments),this.batches=new bV(this._client)}create(a,b){a.model in bX&&console.warn(`The model '${a.model}' is deprecated and will reach end-of-life on ${bX[a.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let c=this._client._options.timeout;if(!a.stream&&null==c){let b=bN[a.model]??void 0;c=this._client.calculateNonstreamingTimeout(a.max_tokens,b)}return this._client.post("/v1/messages",{body:a,timeout:c??6e5,...b,stream:a.stream??!1})}stream(a,b){return bU.createMessage(this,a,b)}countTokens(a,b){return this._client.post("/v1/messages/count_tokens",{body:a,...b})}}let bX={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};bW.Batches=bV;class bY extends by{retrieve(a,b={},c){let{betas:d}=b??{};return this._client.get(bD`/v1/models/${a}`,{...c,headers:bA([{...d?.toString()!=null?{"anthropic-beta":d?.toString()}:void 0},c?.headers])})}list(a={},b){let{betas:c,...d}=a??{};return this._client.getAPIList("/v1/models",bk,{query:d,...b,headers:bA([{...c?.toString()!=null?{"anthropic-beta":c?.toString()}:void 0},b?.headers])})}}let bZ=a=>void 0!==globalThis.process?globalThis.process.env?.[a]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(a)?.trim():void 0;class b${constructor({baseURL:a=bZ("ANTHROPIC_BASE_URL"),apiKey:b=bZ("ANTHROPIC_API_KEY")??null,authToken:c=bZ("ANTHROPIC_AUTH_TOKEN")??null,...d}={}){ab.add(this),ad.set(this,void 0);let e={apiKey:b,authToken:c,...d,baseURL:a||"https://api.anthropic.com"};if(!e.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new aC("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew Anthropic({ apiKey, dangerouslyAllowBrowser: true });\n");this.baseURL=e.baseURL,this.timeout=e.timeout??ac.DEFAULT_TIMEOUT,this.logger=e.logger??console;let f="warn";this.logLevel=f,this.logLevel=a4(e.logLevel,"ClientOptions.logLevel",this)??a4(bZ("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??f,this.fetchOptions=e.fetchOptions,this.maxRetries=e.maxRetries??2,this.fetch=e.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),ax(this,ad,a_,"f"),this._options=e,this.apiKey=b,this.authToken=c}withOptions(a){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...a})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:a,nulls:b}){if(!(this.apiKey&&a.get("x-api-key")||b.has("x-api-key")||this.authToken&&a.get("authorization"))&&!b.has("authorization"))throw Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(a){return bA([this.apiKeyAuth(a),this.bearerAuth(a)])}apiKeyAuth(a){if(null!=this.apiKey)return bA([{"X-Api-Key":this.apiKey}])}bearerAuth(a){if(null!=this.authToken)return bA([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(a){return Object.entries(a).filter(([a,b])=>void 0!==b).map(([a,b])=>{if("string"==typeof b||"number"==typeof b||"boolean"==typeof b)return`${encodeURIComponent(a)}=${encodeURIComponent(b)}`;if(null===b)return`${encodeURIComponent(a)}=`;throw new aC(`Cannot stringify type ${typeof b}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${aU}`}defaultIdempotencyKey(){return`stainless-node-retry-${az()}`}makeStatusError(a,b,c,d){return aD.generate(a,b,c,d)}buildURL(a,b,c){let d=!ay(this,ab,"m",ae).call(this)&&c||this.baseURL,e=new URL(aP.test(a)?a:d+(d.endsWith("/")&&a.startsWith("/")?a.slice(1):a)),f=this.defaultQuery();return!function(a){if(!a)return!0;for(let b in a)return!1;return!0}(f)&&(b={...f,...b}),"object"==typeof b&&b&&!Array.isArray(b)&&(e.search=this.stringifyQuery(b)),e.toString()}_calculateNonstreamingTimeout(a){if(3600*a/128e3>600)throw new aC("Streaming is strongly recommended for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 6e5}async prepareOptions(a){}async prepareRequest(a,{url:b,options:c}){}get(a,b){return this.methodRequest("get",a,b)}post(a,b){return this.methodRequest("post",a,b)}patch(a,b){return this.methodRequest("patch",a,b)}put(a,b){return this.methodRequest("put",a,b)}delete(a,b){return this.methodRequest("delete",a,b)}methodRequest(a,b,c){return this.request(Promise.resolve(c).then(c=>({method:a,path:b,...c})))}request(a,b=null){return new bh(this,this.makeRequest(a,b,void 0))}async makeRequest(a,b,c){let d=await a,e=d.maxRetries??this.maxRetries;null==b&&(b=e),await this.prepareOptions(d);let{req:f,url:g,timeout:h}=this.buildRequest(d,{retryCount:e-b});await this.prepareRequest(f,{url:g,options:d});let i="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),j=void 0===c?"":`, retryOf: ${c}`,k=Date.now();if(a9(this).debug(`[${i}] sending request`,ba({retryOfRequestLogID:c,method:d.method,url:g,options:d,headers:f.headers})),d.signal?.aborted)throw new aE;let l=new AbortController,m=await this.fetchWithTimeout(g,f,h,l).catch(aB),n=Date.now();if(m instanceof Error){let a=`retrying, ${b} attempts remaining`;if(d.signal?.aborted)throw new aE;let e=aA(m)||/timed? ?out/i.test(String(m)+("cause"in m?String(m.cause):""));if(b)return a9(this).info(`[${i}] connection ${e?"timed out":"failed"} - ${a}`),a9(this).debug(`[${i}] connection ${e?"timed out":"failed"} (${a})`,ba({retryOfRequestLogID:c,url:g,durationMs:n-k,message:m.message})),this.retryRequest(d,b,c??i);if(a9(this).info(`[${i}] connection ${e?"timed out":"failed"} - error; no more retries left`),a9(this).debug(`[${i}] connection ${e?"timed out":"failed"} (error; no more retries left)`,ba({retryOfRequestLogID:c,url:g,durationMs:n-k,message:m.message})),e)throw new aG;throw new aF({cause:m})}let o=[...m.headers.entries()].filter(([a])=>"request-id"===a).map(([a,b])=>", "+a+": "+JSON.stringify(b)).join(""),p=`[${i}${j}${o}] ${f.method} ${g} ${m.ok?"succeeded":"failed"} with status ${m.status} in ${n-k}ms`;if(!m.ok){let a=this.shouldRetry(m);if(b&&a){let a=`retrying, ${b} attempts remaining`;return await a$(m.body),a9(this).info(`${p} - ${a}`),a9(this).debug(`[${i}] response error (${a})`,ba({retryOfRequestLogID:c,url:m.url,status:m.status,headers:m.headers,durationMs:n-k})),this.retryRequest(d,b,c??i,m.headers)}let e=a?"error; no more retries left":"error; not retryable";a9(this).info(`${p} - ${e}`);let f=await m.text().catch(a=>aB(a).message),g=aT(f),h=g?void 0:f;throw a9(this).debug(`[${i}] response error (${e})`,ba({retryOfRequestLogID:c,url:m.url,status:m.status,headers:m.headers,message:h,durationMs:Date.now()-k})),this.makeStatusError(m.status,g,h,m.headers)}return a9(this).info(p),a9(this).debug(`[${i}] response start`,ba({retryOfRequestLogID:c,url:m.url,status:m.status,headers:m.headers,durationMs:n-k})),{response:m,options:d,controller:l,requestLogID:i,retryOfRequestLogID:c,startTime:k}}getAPIList(a,b,c){return this.requestAPIList(b,{method:"get",path:a,...c})}requestAPIList(a,b){return new bj(this,this.makeRequest(b,null,void 0),a)}async fetchWithTimeout(a,b,c,d){let{signal:e,method:f,...g}=b||{};e&&e.addEventListener("abort",()=>d.abort());let h=setTimeout(()=>d.abort(),c),i=globalThis.ReadableStream&&g.body instanceof globalThis.ReadableStream||"object"==typeof g.body&&null!==g.body&&Symbol.asyncIterator in g.body,j={signal:d.signal,...i?{duplex:"half"}:{},method:"GET",...g};f&&(j.method=f.toUpperCase());try{return await this.fetch.call(void 0,a,j)}finally{clearTimeout(h)}}shouldRetry(a){let b=a.headers.get("x-should-retry");return"true"===b||"false"!==b&&(408===a.status||409===a.status||429===a.status||!!(a.status>=500))}async retryRequest(a,b,c,d){let e,f,g=d?.get("retry-after-ms");if(g){let a=parseFloat(g);Number.isNaN(a)||(e=a)}let h=d?.get("retry-after");if(h&&!e){let a=parseFloat(h);e=Number.isNaN(a)?Date.parse(h)-Date.now():1e3*a}if(!(e&&0<=e&&e<6e4)){let c=a.maxRetries??this.maxRetries;e=this.calculateDefaultRetryTimeoutMillis(b,c)}return await (f=e,new Promise(a=>setTimeout(a,f))),this.makeRequest(a,b-1,c)}calculateDefaultRetryTimeoutMillis(a,b){return Math.min(.5*Math.pow(2,b-a),8)*(1-.25*Math.random())*1e3}calculateNonstreamingTimeout(a,b){if(36e5*a/128e3>6e5||null!=b&&a>b)throw new aC("Streaming is strongly recommended for operations that may token longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}buildRequest(a,{retryCount:b=0}={}){let c={...a},{method:d,path:e,query:f,defaultBaseURL:g}=c,h=this.buildURL(e,f,g);"timeout"in c&&((a,b)=>{if("number"!=typeof b||!Number.isInteger(b))throw new aC(`${a} must be an integer`);if(b<0)throw new aC(`${a} must be a positive integer`)})("timeout",c.timeout),c.timeout=c.timeout??this.timeout;let{bodyHeaders:i,body:j}=this.buildBody({options:c}),k=this.buildHeaders({options:a,method:d,bodyHeaders:i,retryCount:b});return{req:{method:d,headers:k,...c.signal&&{signal:c.signal},...globalThis.ReadableStream&&j instanceof globalThis.ReadableStream&&{duplex:"half"},...j&&{body:j},...this.fetchOptions??{},...c.fetchOptions??{}},url:h,timeout:c.timeout}}buildHeaders({options:a,method:b,bodyHeaders:c,retryCount:e}){let f={};this.idempotencyHeader&&"get"!==b&&(a.idempotencyKey||(a.idempotencyKey=this.defaultIdempotencyKey()),f[this.idempotencyHeader]=a.idempotencyKey);let g=bA([f,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(e),...a.timeout?{"X-Stainless-Timeout":String(Math.trunc(a.timeout/1e3))}:{},...d??(d=(()=>{let a="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===a)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":aU,"X-Stainless-OS":aW(Deno.build.os),"X-Stainless-Arch":aV(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":aU,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===a)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":aU,"X-Stainless-OS":aW(globalThis.process.platform??"unknown"),"X-Stainless-Arch":aV(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let b=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:a,pattern:b}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let c=b.exec(navigator.userAgent);if(c){let b=c[1]||0,d=c[2]||0,e=c[3]||0;return{browser:a,version:`${b}.${d}.${e}`}}}return null}();return b?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":aU,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${b.browser}`,"X-Stainless-Runtime-Version":b.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":aU,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},this.authHeaders(a),this._options.defaultHeaders,c,a.headers]);return this.validateHeaders(g),g.values}buildBody({options:{body:a,headers:b}}){if(!a)return{bodyHeaders:void 0,body:void 0};let c=bA([b]);return ArrayBuffer.isView(a)||a instanceof ArrayBuffer||a instanceof DataView||"string"==typeof a&&c.values.has("content-type")||a instanceof Blob||a instanceof FormData||a instanceof URLSearchParams||globalThis.ReadableStream&&a instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:a}:"object"==typeof a&&(Symbol.asyncIterator in a||Symbol.iterator in a&&"next"in a&&"function"==typeof a.next)?{bodyHeaders:void 0,body:aY(a)}:ay(this,ad,"f").call(this,{body:a,headers:c})}}ac=b$,ad=new WeakMap,ab=new WeakSet,ae=function(){return"https://api.anthropic.com"!==this.baseURL},b$.Anthropic=ac,b$.HUMAN_PROMPT="\n\nHuman:",b$.AI_PROMPT="\n\nAssistant:",b$.DEFAULT_TIMEOUT=6e5,b$.AnthropicError=aC,b$.APIError=aD,b$.APIConnectionError=aF,b$.APIConnectionTimeoutError=aG,b$.APIUserAbortError=aE,b$.NotFoundError=aK,b$.ConflictError=aL,b$.RateLimitError=aN,b$.BadRequestError=aH,b$.AuthenticationError=aI,b$.InternalServerError=aO,b$.PermissionDeniedError=aJ,b$.UnprocessableEntityError=aM,b$.toFile=bw;class b_ extends b${constructor(){super(...arguments),this.completions=new bR(this),this.messages=new bW(this),this.models=new bY(this),this.beta=new bQ(this)}}b_.Completions=bR,b_.Messages=bW,b_.Models=bY,b_.Beta=bQ;let{HUMAN_PROMPT:b0,AI_PROMPT:b1}=b_,b2=(0,c(75466).UU)("https://xuhreqjmarcukbcxymgs.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),b3=process.env.OPENAI_API_KEY?new aw.Ay({apiKey:process.env.OPENAI_API_KEY}):null,b4=process.env.ANTHROPIC_API_KEY?new b_({apiKey:process.env.ANTHROPIC_API_KEY}):null,b5=process.env.OPENROUTER_API_KEY?new aw.Ay({apiKey:process.env.OPENROUTER_API_KEY,baseURL:"https://openrouter.ai/api/v1"}):null;async function b6(a){try{let b,{contextId:c,question:d,model:e="openai",modelName:f}=await a.json();if(!c||!d)return new Response(JSON.stringify({error:"Context ID and question are required"}),{status:400,headers:{"Content-Type":"application/json"}});let{data:g,error:h}=await b2.from("website_contexts").select("*").eq("id",c).single();if(h||!g)return new Response(JSON.stringify({error:"Context not found"}),{status:404,headers:{"Content-Type":"application/json"}});if("completed"!==g.status)return new Response(JSON.stringify({error:"Context analysis not completed"}),{status:400,headers:{"Content-Type":"application/json"}});let i=function(a){let b=a.page_content?.[0]||{},c=a.search_terms||[],d=a.search_results||[],e=a.analysis_summary||{};return`You are a highly intelligent marketing leader with an IQ of 180. Your objective is to deliver insightful and strategic marketing advice in the style of Paul Graham - clear, candid, and constructive. 

You have analyzed this website and its competitive landscape:

WEBSITE DATA:
URL: ${a.url}
Title: ${b.title||"Unknown"}
Description: ${b.description||"No description"}

BUSINESS OVERVIEW:
${e.business_overview||"Business analysis in progress"}

CONTENT SNAPSHOT:
${b.content?.slice(0,2e3)||"Content unavailable"}...

COMPETITIVE INTEL:
Search Terms: ${c.slice(0,8).join(", ")}
${d.slice(0,3).map(a=>`
• ${a.query}: ${a.organic?.slice(0,2).map(a=>a.title).join(", ")||"No data"}
`).join("")}

KEY INSIGHTS:
${e.key_strengths?.map(a=>`• ${a}`).join("\n")||"• Analysis in progress"}

TONE INSTRUCTIONS:
1. **Clear, Candid, and Constructive:** Be direct yet respectful, thoughtful without being verbose. Emulate Paul Graham's mentor-like tone.
2. **Conversational Intelligence:** Write as if addressing a sharp but busy founder. Avoid jargon and overly polished marketing language.
3. **Thoughtful Contrarianism:** Challenge assumptions, especially when mainstream advice is flawed.

FORMATTING RULES:
1. **Open with a Core Insight:** Start every response with the most critical idea or recommendation.
2. **Use Simple Structure:** Organize into clear sections like "Why this matters," "How to think about it," "Action steps," "Common traps to avoid."
3. **Favor Bullets Over Paragraphs:** Present advice in crisp, list-based format.
4. **Include Real Examples:** Reference practical examples when relevant.

PAUL GRAHAM MENTAL MODELS TO APPLY:
- Doing things that don't scale
- Default alive vs default dead
- Ramen profitability
- Writing conversationally  
- Being relentlessly resourceful

Answer questions about this website using the data above. Prioritize clarity over correctness, focus on usable insights, and offer honest feedback even if uncomfortable.`}(g),j=e;switch(e){case"anthropic":b=await b8(i,d),j="Claude 3.5 Sonnet";break;case"openrouter":b=await b9(i,d,f),j=f||"OpenRouter Model";break;default:b=await b7(i,d),j="GPT-4"}return new Response(JSON.stringify({content:b.content,model:j,contextUrl:g.url,analysisDate:g.analyzed_at}),{status:200,headers:{"Content-Type":"application/json"}})}catch(a){return console.error("Chat with context error:",a),new Response(JSON.stringify({error:"Failed to generate response",details:a.message}),{status:500,headers:{"Content-Type":"application/json"}})}}async function b7(a,b){try{return{content:(await b3.chat.completions.create({model:"gpt-4",messages:[{role:"system",content:a},{role:"user",content:b}],temperature:.7,max_tokens:2e3})).choices[0].message.content,model:"GPT-4"}}catch(a){throw console.error("OpenAI API error:",a),Error("OpenAI API request failed")}}async function b8(a,b){try{return{content:(await b4.messages.create({model:"claude-3-5-sonnet-20241022",max_tokens:2e3,messages:[{role:"user",content:`${a}

Question: ${b}`}],temperature:.7})).content[0].text,model:"Claude 3.5 Sonnet"}}catch(a){throw console.error("Anthropic API error:",a),Error("Anthropic API request failed")}}async function b9(a,b,c){try{let d=c||"anthropic/claude-3.5-sonnet";return{content:(await b5.chat.completions.create({model:d,messages:[{role:"system",content:a},{role:"user",content:b}],temperature:.7,max_tokens:2e3})).choices[0].message.content,model:d}}catch(a){throw console.error("OpenRouter API error:",a),Error("OpenRouter API request failed")}}let ca=new ag.AppRouteRouteModule({definition:{kind:ah.RouteKind.APP_ROUTE,page:"/api/ai/chat-with-context/route",pathname:"/api/ai/chat-with-context",filename:"route",bundlePath:"app/api/ai/chat-with-context/route"},distDir:".next",projectDir:"",resolvedPagePath:"/Users/joshuahaydon/ai-marketing-pro/src/app/api/ai/chat-with-context/route.js",nextConfigOutput:"standalone",userland:af}),{workAsyncStorage:cb,workUnitAsyncStorage:cc,serverHooks:cd}=ca;function ce(){return(0,ai.patchFetch)({workAsyncStorage:cb,workUnitAsyncStorage:cc})}async function cf(a,b,c){var d;let e="/api/ai/chat-with-context/route";"/index"===e&&(e="/");let f=await ca.prepare(a,b,{srcPage:e,multiZoneDraftMode:"false"});if(!f)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:g,params:h,nextConfig:i,isDraftMode:j,prerenderManifest:k,routerServerContext:l,isOnDemandRevalidate:m,revalidateOnlyGenerated:n,resolvedPathname:o}=f,p=(0,al.normalizeAppPath)(e),q=!!(k.dynamicRoutes[p]||k.routes[o]);if(q&&!j){let a=!!k.routes[o],b=k.dynamicRoutes[p];if(b&&!1===b.fallback&&!a)throw new au.NoFallbackError}let r=null;!q||ca.isDev||j||(r="/index"===(r=o)?"/":r);let s=!0===ca.isDev||!q,t=q&&!s,u=a.method||"GET",v=(0,ak.getTracer)(),w=v.getActiveScopeSpan(),x={params:h,prerenderManifest:k,renderOpts:{experimental:{dynamicIO:!!i.experimental.dynamicIO,authInterrupts:!!i.experimental.authInterrupts},supportsDynamicResponse:s,incrementalCache:(0,aj.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=i.experimental)?void 0:d.cacheLife,isRevalidate:t,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>ca.onRequestError(a,b,d,l)},sharedContext:{buildId:g}},y=new am.NodeNextRequest(a),z=new am.NodeNextResponse(b),A=an.NextRequestAdapter.fromNodeNextRequest(y,(0,an.signalFromNodeResponse)(b));try{let d=async c=>ca.handle(A,x).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=v.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==ao.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${u} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${u} ${a.url}`)}),f=async f=>{var g,h;let o=async({previousCacheEntry:g})=>{try{if(!(0,aj.getRequestMeta)(a,"minimalMode")&&m&&n&&!g)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(f);a.fetchMetrics=x.renderOpts.fetchMetrics;let h=x.renderOpts.pendingWaitUntil;h&&c.waitUntil&&(c.waitUntil(h),h=void 0);let i=x.renderOpts.collectedTags;if(!q)return await (0,aq.I)(y,z,e,x.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,ar.toNodeOutgoingHttpHeaders)(e.headers);i&&(b[at.NEXT_CACHE_TAGS_HEADER]=i),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==x.renderOpts.collectedRevalidate&&!(x.renderOpts.collectedRevalidate>=at.INFINITE_CACHE)&&x.renderOpts.collectedRevalidate,d=void 0===x.renderOpts.collectedExpire||x.renderOpts.collectedExpire>=at.INFINITE_CACHE?void 0:x.renderOpts.collectedExpire;return{value:{kind:av.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==g?void 0:g.isStale)&&await ca.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,ap.c)({isRevalidate:t,isOnDemandRevalidate:m})},l),b}},p=await ca.handleResponse({req:a,nextConfig:i,cacheKey:r,routeKind:ah.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:m,revalidateOnlyGenerated:n,responseGenerator:o,waitUntil:c.waitUntil});if(!q)return null;if((null==p||null==(g=p.value)?void 0:g.kind)!==av.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(h=p.value)?void 0:h.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,aj.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",m?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),j&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let s=(0,ar.fromNodeOutgoingHttpHeaders)(p.value.headers);return(0,aj.getRequestMeta)(a,"minimalMode")&&q||s.delete(at.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||b.getHeader("Cache-Control")||s.get("Cache-Control")||s.set("Cache-Control",(0,as.getCacheControlHeader)(p.cacheControl)),await (0,aq.I)(y,z,new Response(p.value.body,{headers:s,status:p.value.status||200})),null};w?await f(w):await v.withPropagatedContext(a.headers,()=>v.trace(ao.BaseServerSpan.handleRequest,{spanName:`${u} ${a.url}`,kind:ak.SpanKind.SERVER,attributes:{"http.method":u,"http.target":a.url}},f))}catch(b){if(w||await ca.onRequestError(a,b,{routerKind:"App Router",routePath:p,routeType:"route",revalidateReason:(0,ap.c)({isRevalidate:t,isOnDemandRevalidate:m})}),q)throw b;return await (0,aq.I)(y,z,new Response(null,{status:500})),null}}},74075:a=>{"use strict";a.exports=require("zlib")},78335:()=>{},79428:a=>{"use strict";a.exports=require("buffer")},79551:a=>{"use strict";a.exports=require("url")},81630:a=>{"use strict";a.exports=require("http")},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},91645:a=>{"use strict";a.exports=require("net")},94735:a=>{"use strict";a.exports=require("events")},96487:()=>{}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[431,611,694],()=>b(b.s=71982));module.exports=c})();